<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ç·šä¸Š Python ç·¨è¼¯å™¨</title>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.11.1/brython.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.11.1/brython_stdlib.js"></script>
<style>
body { font-family: Arial; margin: 20px; }
textarea { width: 100%; height: 300px; font-family: monospace; font-size: 14px; }
#output { width: 100%; height: 150px; border: 1px solid #ccc; padding: 5px; overflow-y: auto; background:#f9f9f9; }
input { width: 150px; }
button { margin: 2px; }
.keyword { color: blue; }
.string { color: green; }
.comment { color: gray; }
.toolbar { margin-bottom: 5px; }
</style>
</head>
<body onload="brython()">

<h2>ç·šä¸Š Python ç·¨è¼¯å™¨</h2>

<div class="toolbar">
<button id="cutBtn">âœ‚ï¸ å‰ªä¸‹</button>
<button id="copyBtn">ğŸ“„ è¤‡è£½</button>
<button id="pasteBtn">ğŸ“‹ è²¼ä¸Š</button>
<button id="selectAllBtn">ğŸ” å…¨é¸</button>
<button id="clearBtn">ğŸ§¹ æ¸…é™¤</button>
<label>èªè¨€: 
<select id="langSelect">
  <option value="Python" selected>Python</option>
  <option value="JavaScript">JavaScript</option>
  <option value="Markdown">Markdown</option>
</select>
</label>
</div>

<label>æœå°‹: <input id="search"></label>
<label>å–ä»£ç‚º: <input id="replace"></label>
<button id="searchBtn">æœå°‹ä¸‹ä¸€å€‹</button>
<button id="replaceBtn">å…¨éƒ¨å–ä»£</button>

<br><br>

<textarea id="editor">
print("Hello Brython!")
for i in range(5):
    print(i)
</textarea>
<br>
<button id="runBtn">åŸ·è¡Œç¨‹å¼</button>

<h3>è¼¸å‡ºçµæœ:</h3>
<div id="output"></div>

<script type="text/python">
from browser import document, html

editor = document['editor']
output_div = document['output']
search_input = document['search']
replace_input = document['replace']
lang_select = document['langSelect']

# --------------------- åŸ·è¡Œç¨‹å¼ ---------------------
def run(ev):
    output_div.clear()
    code = editor.value
    try:
        class DivWriter:
            def write(self, txt): output_div <= html.P(txt)
        import sys
        sys.stdout = DivWriter()
        exec(code)
        sys.stdout = sys.__stdout__
    except Exception as e:
        output_div <= html.P(f"éŒ¯èª¤: {e}")

document['runBtn'].bind('click', run)

# --------------------- æœå°‹èˆ‡å–ä»£ ---------------------
current_index = [0]

def search_next(ev):
    text = editor.value
    target = search_input.value
    if not target:
        return
    idx = text.find(target, current_index[0])
    if idx == -1:
        current_index[0] = 0
        output_div <= html.P("æ‰¾ä¸åˆ°æ›´å¤šç¬¦åˆé …ç›®")
        return
    current_index[0] = idx + len(target)
    output_div <= html.P(f"æ‰¾åˆ°: '{target}' at {idx}")

document['searchBtn'].bind('click', search_next)

def replace_all(ev):
    text = editor.value
    target = search_input.value
    replacement = replace_input.value
    if not target:
        return
    editor.value = text.replace(target, replacement)
    output_div <= html.P("å…¨éƒ¨å–ä»£å®Œæˆ")

document['replaceBtn'].bind('click', replace_all)

# --------------------- å·¥å…·åˆ—åŠŸèƒ½ ---------------------
def cut(ev):
    document.execCommand("cut")

def copy(ev):
    document.execCommand("copy")

def paste(ev):
    document.execCommand("paste")

def select_all(ev):
    editor.focus()
    editor.select()

def clear(ev):
    editor.value = ""

document['cutBtn'].bind('click', cut)
document['copyBtn'].bind('click', copy)
document['pasteBtn'].bind('click', paste)
document['selectAllBtn'].bind('click', select_all)
document['clearBtn'].bind('click', clear)

# --------------------- ç°¡å–® Python èªæ³•é«˜äº® ---------------------
PY_KEYWORDS = [
    'False','class','finally','is','return','None','continue','for',
    'lambda','try','True','def','from','nonlocal','while','and','del',
    'global','not','with','as','elif','if','or','yield','assert',
    'else','import','pass','break','except','in','raise'
]

def highlight_syntax(ev=None):
    import re
    content = editor.value
    # å…ˆæ¸…ç©º
    editor.style.background = "#fff"
    # é«˜äº®é—œéµå­—ï¼ˆç°¡å–®æ–¹å¼ï¼‰
    for kw in PY_KEYWORDS:
        pattern = r'\b{}\b'.format(kw)
        for m in re.finditer(pattern, content):
            pass
            # é«˜äº®åŠŸèƒ½å¯ç”¨ CSS æ¨™è¨˜æˆ–å¤–éƒ¨å¥—ä»¶ï¼Œç€è¦½å™¨ textarea é™åˆ¶ï¼Œæš«æ™‚ä¸æ¨™è‰²

editor.bind("input", highlight_syntax)

</script>

</body>
</html>
